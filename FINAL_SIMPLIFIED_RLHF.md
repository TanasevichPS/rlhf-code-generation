# üéâ –§–∏–Ω–∞–ª—å–Ω–∞—è –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è RLHF –°–∏—Å—Ç–µ–º–∞ - –ì–æ—Ç–æ–≤–æ!

## ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞!

–Ø —Å–æ–∑–¥–∞–ª **–ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–æ–≤—É—é, —É–ø—Ä–æ—â–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É RLHF** —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏, –∏—Å–ø—Ä–∞–≤–∏–ª –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∏ —Å–¥–µ–ª–∞–ª –µ—ë –≥–æ—Ç–æ–≤–æ–π –¥–ª—è –≤–∞—à–∏—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ü–µ–ª–µ–π.

## üèóÔ∏è –§–∏–Ω–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
rlhf_code_project/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ training_config.py    # ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ preference_dataset.py # ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ training/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ dpo_trainer.py        # ‚úÖ –ü–æ–ª–Ω—ã–π DPO trainer
‚îÇ   ‚îî‚îÄ‚îÄ simple_dpo_trainer.py # ‚úÖ –ü—Ä–æ—Å—Ç–æ–π trainer (fallback)
‚îú‚îÄ‚îÄ evaluation/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ metrics_calculator.py # ‚úÖ –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ train.py              # ‚úÖ –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ requirements.txt          # ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md                 # ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **PyTorch —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `AutoModelForCausalLM` vs `AutoModel`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω fallback –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏–π transformers
- ‚úÖ –£–±—Ä–∞–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç PyTorch 2.1+

### 2. **NumPy —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ –≤–µ—Ä—Å–∏—è NumPy: `numpy>=1.21.0,<2.0.0`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å NumPy 2.0

### 3. **–ü—Ä–æ—Å—Ç–æ–π trainer**
- ‚úÖ –°–æ–∑–¥–∞–Ω `SimpleDPOTrainer` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ —Ç—è–∂–µ–ª—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ –ø—Ä–æ—Å—Ç–æ–π trainer –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### 1. **–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**
```bash
python quick_test.py
```

### 2. **–ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**
```bash
python test_simple_rlhf.py
```

### 3. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
```bash
pip install -r rlhf_code_project/requirements.txt
```

### 4. **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç**
```bash
python quick_start_simple.py
```

### 5. **–ü–æ–ª–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ**
```bash
# –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç (2 —ç–ø–æ—Ö–∏)
python rlhf_code_project/scripts/train.py --fast

# –ü–æ–ª–Ω–æ–µ DPO –æ–±—É—á–µ–Ω–∏–µ
python rlhf_code_project/scripts/train.py --method dpo --epochs 5 --batch-size 8

# –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º
python rlhf_code_project/scripts/train.py --method dpo --epochs 10 --batch-size 4
```

## üìä –¶–µ–ª–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

–°–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:
- **BERTScore**: ‚â• 0.7 (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ)
- **CodeBLEU**: ‚â• 0.6 (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –¥–ª—è –∫–æ–¥–∞ –æ—Ü–µ–Ω–∫–∞)
- **BLEU**: ‚â• 0.4 (n-gram overlap)
- **ROUGE**: ‚â• 0.5 (–º–µ—Ç—Ä–∏–∫–∏ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏)
- **Ruby**: ‚â• 0.3 (–∫–∞—Å—Ç–æ–º–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞)

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```python
from rlhf_code_project.config import get_fast_config, get_dpo_config, get_research_config

# –ë—ã—Å—Ç—Ä–æ–µ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
config = get_fast_config()

# –ü—Ä–æ–¥–∞–∫—à–Ω DPO –æ–±—É—á–µ–Ω–∏–µ
config = get_dpo_config()

# –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã
config = get_research_config()
```

### –ö–∞—Å—Ç–æ–º–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```python
from rlhf_code_project.config import RLHFConfig

config = RLHFConfig(
    method="dpo",
    learning_rate=1e-5,
    batch_size=8,
    num_epochs=5,
    target_bertscore=0.8,
    target_codebleu=0.7,
    use_human_feedback=True
)
```

## üìà –ú–µ—Ç–æ–¥—ã –æ–±—É—á–µ–Ω–∏—è

### DPO (Direct Preference Optimization)
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**: –ü—Ä–æ—â–µ PPO, —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ RLHF –æ–±—É—á–µ–Ω–∏–µ
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### Simple DPO (Fallback)
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**: –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Ç—è–∂–µ–ª—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

## üî¨ –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
```python
config.use_human_feedback = True
config.human_feedback_dim = 64
config.human_feedback_weight = 0.3
```

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤
```python
# –î–æ–±–∞–≤–∏—Ç—å –≤ requirements.txt: wandb>=0.15.0
# –í–∫–ª—é—á–∏—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ: use_wandb = True
```

## üìù –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

### –î–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π (–¥–ª—è DPO)
```csv
prompt,chosen_response,rejected_response
"Write a function to calculate factorial","def factorial(n):\n    if n <= 1:\n        return 1\n    return n * factorial(n - 1)","def factorial(n):\n    return 1"
```

### –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ü–µ–Ω–∫–∏
```csv
prompt,reference
"Write a function to add two numbers","def add(a, b):\n    return a + b"
```

## üéâ –ü–æ—á–µ–º—É —ç—Ç–æ –ª—É—á—à–µ

1. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –†–∞–±–æ—Ç–∞–µ—Ç —Å –≤–∞—à–µ–π —Ç–µ–∫—É—â–µ–π —Å—Ä–µ–¥–æ–π
2. **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: 8 –º–æ–¥—É–ª–µ–π –≤–º–µ—Å—Ç–æ 20+ —Ñ–∞–π–ª–æ–≤
3. **–°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å**: DPO –≤–º–µ—Å—Ç–æ —Å–ª–æ–∂–Ω–æ–≥–æ PPO
4. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ –ø—Ä–æ—Å—Ç–æ–π trainer
5. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: –°–æ–∑–¥–∞–Ω–æ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –≤–∞—à–∏—Ö —Ü–µ–ª–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫

## üî¨ –ù–∞—É—á–Ω–∞—è –æ—Å–Ω–æ–≤–∞

- **DPO**: Direct Preference Optimization (Rafailov et al., 2023)
- **Human Feedback**: Learning from Human Preferences (Christiano et al., 2017)
- **Code Generation**: –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∏–∑ CodeX, AlphaCode

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ `./rlhf_outputs/` –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ issue.

---

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

**–§–∏–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ RLHF –≥–æ—Ç–æ–≤–∞ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –≤–∞—à–∏—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ü–µ–ª–µ–π!**

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±—ã—Å—Ç—Ä—É—é –ø—Ä–æ–≤–µ—Ä–∫—É**: `python quick_test.py`
2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É**: `python test_simple_rlhf.py`
3. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: `pip install -r rlhf_code_project/requirements.txt`
4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç**: `python quick_start_simple.py`
5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ**: `python rlhf_code_project/scripts/train.py --method dpo --epochs 10`

**–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è, —Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ RLHF –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞!** üéâ

---

## üìã –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ

| –ê—Å–ø–µ–∫—Ç | –ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ | –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ |
|--------|-------------------|---------------|
| **–§–∞–π–ª–æ–≤** | 20+ | 8 |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å** | –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∞—è |
| **–ú–µ—Ç–æ–¥—ã** | PPO | DPO (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π) |
| **–ú–µ—Ç—Ä–∏–∫–∏** | –ß–∞—Å—Ç–∏—á–Ω–æ | –í—Å–µ —Ü–µ–ª–µ–≤—ã–µ |
| **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** | –°–ª–æ–∂–Ω–∞—è | –ü—Ä–æ—Å—Ç–∞—è |
| **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** | –°–ª–æ–∂–Ω–æ–µ | –ü—Ä–æ—Å—Ç–æ–µ |
| **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** | –ü—Ä–æ–±–ª–µ–º—ã | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ |
| **Fallback** | –ù–µ—Ç | –ï—Å—Ç—å |
| **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å** | –ß–∞—Å—Ç–∏—á–Ω–∞—è | –ü–æ–ª–Ω–∞—è |

**–ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤ 3 —Ä–∞–∑–∞ –ø—Ä–æ—â–µ, —Å–æ–≤–º–µ—Å—Ç–∏–º–µ–µ, –Ω–∞–¥–µ–∂–Ω–µ–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ!** üöÄ
